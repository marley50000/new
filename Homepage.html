<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Agent Spark Ghana</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.3/css/all.min.css" rel="stylesheet" />
  <style>
    body { font-family: 'Inter', sans-serif; }
    .fade-in { opacity: 0; transform: translateY(20px); animation: fadeInUp 1s ease-out forwards; }
    @keyframes fadeInUp { to { opacity: 1; transform: translateY(0); } }
  </style>
</head>
<body class="bg-[#f0f5fa] min-h-screen p-4">
  <main class="max-w-7xl mx-auto fade-in">
    <h1 class="text-3xl font-bold text-center mb-6">Find verified agents in Ghana</h1>

    <!-- Search Bar -->
    <form class="max-w-md mx-auto relative mb-10">
      <input id="searchInput" type="text" placeholder="Find agents near you..." class="w-full rounded-lg py-3 px-4 pr-12 text-gray-700 placeholder-gray-500 focus:ring-2 focus:ring-blue-500 shadow-sm" />
      <button type="submit" class="absolute right-3 top-1/2 -translate-y-1/2 text-gray-600 hover:text-gray-900"><i class="fas fa-search"></i></button>
    </form>

    <!-- Categories -->
    <div class="flex flex-wrap justify-center gap-4 mb-8">
      <button class="category-btn"><i class="fas fa-home text-blue-600 text-2xl"></i><br>Rentals</button>
      <button class="category-btn"><i class="fas fa-shield-alt text-blue-600 text-2xl"></i><br>Insurance</button>
      <button class="category-btn"><i class="fas fa-gavel text-blue-600 text-2xl"></i><br>Legal Help</button>
      <button class="category-btn"><i class="fas fa-passport text-blue-600 text-2xl"></i><br>Visa</button>
      <button class="category-btn"><span class="text-2xl font-bold">...</span><br>Others</button>
    </div>

    <!-- Featured Agents -->
    <section class="bg-white rounded-3xl p-6 mb-10 shadow-md">
      <h2 class="text-xl font-semibold mb-6">Featured Agents</h2>
      <div id="agents-container" class="grid grid-cols-1 sm:grid-cols-2 md:grid-cols-4 gap-6"></div>
      <p id="loading" class="text-center text-gray-500 mt-4">Loading agents...</p>
    </section>

    <!-- Why Choose Section -->
    <section class="flex flex-wrap justify-around items-center bg-white p-6 rounded-3xl shadow-md">
      <h3 class="text-xl font-semibold w-full text-center mb-4">Why Choose Verified Agents?</h3>
      <div class="flex flex-wrap justify-center gap-6 w-full">
        <div class="flex items-center gap-2 text-sm font-medium text-gray-700">
          <i class="fas fa-user-check text-blue-600"></i> Verified Professionals
        </div>
        <div class="flex items-center gap-2 text-sm font-medium text-gray-700">
          <i class="fas fa-thumbs-up text-blue-600"></i> Trusted by Users
        </div>
        <div class="flex items-center gap-2 text-sm font-medium text-gray-700">
          <i class="fas fa-shield-alt text-blue-600"></i> Peace of Mind
        </div>
      </div>
    </section>
  </main>

  <script src="https://unpkg.com/@supabase/supabase-js"></script>
  <script>
    document.addEventListener('DOMContentLoaded', () => {
      const supabaseUrl = 'https://qzddjvloicjwshggzctt.supabase.co';
      const supabaseKey = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InF6ZGRqdmxvaWNqd3NoZ2d6Y3R0Iiwicm9sZSI6ImFub24iLCJpYXQiOjE3NDk0MDk5MzMsImV4cCI6MjA2NDk4NTkzM30.mkrERrCanIkNnIlch5UJ-OOJ9az7oXs1EFZijkf7y7o'; // Add your real key here
      const supabase = window.supabase.createClient(supabaseUrl, supabaseKey);
      const storageBaseUrl = `${supabaseUrl}/storage/v1/object/public/agent-images/`;

      async function loadAgents() {
        const { data, error } = await supabase.from('agents').select('*').order('created_at', { ascending: false });
        const container = document.getElementById('agents-container');
        const loading = document.getElementById('loading');

        if (error || !data) {
          loading.textContent = "Failed to load agents.";
          return;
        }

        container.innerHTML = '';
        loading.style.display = 'none';

        for (const agent of data) {
          let photoUrl = 'https://via.placeholder.com/300';
          if (agent.photo_path) {
            const cleanedPath = agent.photo_path.replace('agent-images/', '');
            photoUrl = `${storageBaseUrl}${cleanedPath}`;
          }

          container.innerHTML += `
            <article class="bg-[#f7f9fc] rounded-xl overflow-hidden shadow-sm flex flex-col">
              <img src="${photoUrl}" class="w-full object-cover aspect-square" alt="${agent.full_name}" />
              <div class="p-3">
                <h3 class="font-semibold text-base">${agent.full_name}</h3>
                <p class="text-sm text-yellow-500"><i class="fas fa-star"></i> ${agent.rating || '4.5'}</p>
                <p class="text-xs text-gray-800">${agent.category || 'Agent'}</p>
                <button class="mt-2 bg-blue-600 text-white rounded-md py-1 px-4 text-sm w-full">View Profile</button>
              </div>
            </article>`;
        }
      }

      loadAgents();
    });
  </script>
</body>
</html>
